<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
  <!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Chuck Norris Day Facts</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <h1>Chuck Norris Day Facts</h1>

    <div class="jumbotron">
      <h1 class="display-4">Hello, world!</h1>
      <p class="lead">
        This is a simple hero unit, a simple jumbotron-style component for
        calling extra attention to featured content or information.
      </p>
      <hr class="my-4" />
      <p>
        It uses utility classes for typography and spacing to space content out
        within the larger container.
      </p>
      <a class="btn btn-primary btn-lg" href="#" role="button">Learn more</a>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-10">
          <p id="fact"></p>
        </div>
        <div class="col-1">
          <button class="btn-primary" id="new-fact">New Fact</button>
        </div>
        <div class="col-1">
          <button class="btn-primary" id="new-banana-fact">Banana Fact</button>
        </div>
      </div>
      <div class="row">
        <form>
          <div class="form-group">
            <input
              type="text"
              class="form-control"
              id="new-query"
              placeholder="Type a term to search"
            />
          </div>
          <button type="submit" class="btn btn-primary" id="new-query-button">
            Search
          </button>
        </form>
      </div>
      <div class="row">
        <div class="col" id="recent-searches"></div>
      </div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>
    <script src="script.js"></script>
    <script>
      $(document).ready(function() {
        function displayJoke(jokeToDisplay) {
          $("#fact").text(jokeToDisplay);
        }

        readAndDisplay();

        function readAndDisplay(searchTerm) {
          // 2. Read from local storage.
          var searchTermsArray = localStorage.getItem("searchTerms");
          if (searchTermsArray === null) {
            localStorage.setItem("searchTerms", JSON.stringify([searchTerm]));
          } else if (searchTerm) {
            // 3. Add my new search term.
            searchTermsArray = JSON.parse(searchTermsArray);
            searchTermsArray.push(searchTerm);
            // 4. Write to local storage.
            localStorage.setItem(
              "searchTerms",
              JSON.stringify(searchTermsArray)
            );
          } else {
            searchTermsArray = JSON.parse(searchTermsArray);
          }
          // 5. Update the DOM
          var recentSearches = $("#recent-searches");
          recentSearches.empty();
          for (var i = 0; i < searchTermsArray.length; i++) {
            recentSearches.append(
              "<div class='row'><h1>" + searchTermsArray[i] + "</h1></div>"
            );
          }
        }

        // console.log("This is inside my script tag in html");
        $("#new-query-button").on("click", function(event) {
          event.preventDefault();
          // console.log("You clicked my new query button");

          var searchTerm = $("#new-query").val();

          console.log(searchTerm);

          // AJAX Call
          // pass in the searchTerm we grabbed above
          var queryURL =
            "https://api.chucknorris.io/jokes/search?query=" + searchTerm;
          // identify the url and the get method
          $.ajax({
            url: queryURL,
            method: "GET"
          }).then(function(response) {
            console.log(response.result[0].value);
            // 1. Populate the page with the information - quote
            displayJoke(response.result[0].value);
            readAndDisplay(searchTerm);
          });
        });
      });
    </script>
  </body>
</html>
